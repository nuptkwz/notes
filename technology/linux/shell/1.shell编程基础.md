> 本篇文章整理了shell编程的一些基础知识。

# shell基本概念

## Shell概述

Shell 是一个应用程序，它连接了用户和Linux 内核，让用户能够更加高效、安全、低成本地使用Linux 内核，这就是Shell 的本质。

Shell的作用：

- 解释执行用户输入的命令或程序等
- 用户输入一条命令，shell就解释一条
- 键盘输入命令，Linux给与响应的方式，称之为交互式

我们平时敲的一些命令，比如ls，都是一段C语言代码，这段代码编译生成二进制文件，也就得到了我们的ls命令。如：

```shell
[root@keweizhou1 ~]# which ls
alias ls='ls --color=auto'
        /usr/bin/ls
```

shell脚本的规则： 在Linux系统中，shell脚本或者称之为(bash shell程序)通常都是vim编辑，由Linux命令、bash shell指令，逻辑控制语句和注释信息组成。

## Shebang

计算机程序中，shebang指的是出现在文本文件第一行的前两个字符#!，在unix系统中，程序会分析shebang后面的内容，作为解析器的指令，例如：

- 以#! /bin/sh 开头的文件会调用/bin/sh，也就是bash解析器
- 以#! /usr/bin/python 开头的文件，代表制定python解析器去执行（比如yum命令就是python写的，在/usr/bin/yum目录下）
- 以#! /usr/bin/env 解析器名称，是一种在不同平台上都能正确找到解析器的办法

```shell
[root@keweizhou1 ~]# ls -l /bin/sh
lrwxrwxrwx. 1 root root 4 May  1  2022 /bin/sh -> bash
```

执行一个shell脚本的几种方式：

1. /bin/bash ./hello.sh

```shell
[root@keweizhou1 shell]# /bin/bash ./hello.sh
hello world
```

2. /bin/sh ./hello.sh 也可以sh ./hello.sh

```shell
[root@keweizhou1 shell]# /bin/sh ./hello.sh
hello world
```

3. ./hello.sh

```shell
[root@keweizhou1 shell]# ./hello.sh
hello world
```

同理，python也可以执行：

```shell
#! /usr/bin/python
# coding:utf-8
print("hello python")


[root@keweizhou1 shell]# ./pytest.py
hello python
```

4.source hello.sh

```shell
[root@keweizhou1 shell]# source hello.sh
hello world
```

## shell脚本的规范

基本规范：

- “#”后面表示注释掉的内容，提供给开发者或者使用者观看的，系统会忽略掉此行
- 注释可以单独写一行，也可以跟在命令后面
- 尽量保持写注释的习惯，尽量写英文

## shell和运维

shell语言很适合处理纯文本型数据，且Linux的哲学思想就是一切皆文件，如日志、配置文件、文本、网页文本，大多数都是纯文本型的，因此shell可以方便的进行文本 处理，好比强大的Linux三剑客：grep、sed、awk

shell语言属于一种弱类型的语言，无需声明变量类型，直接定义使用。弱类型语言，在定义数据类型的时候，不用主动声明类型。强类型的编程语言，就需要制定变量的类型 比如C语言、Java等。

# bash笔记

## bash的一些简单命令

1. 如查看历史记录条目大小：

```shell
[root@keweizhou1 shell]# echo $HISTSIZE
1000
```

2. history文件存储位置：

```shell
[root@keweizhou1 shell]# echo $HISTFILE
/root/.bash_history
```

3. History命令：

- -c 清除历史
- -r 恢复历史

例如：

```shell
[root@keweizhou1 shell]# history -c
[root@keweizhou1 shell]# history
   44  history
   
[root@keweizhou1 shell]# history -r
[root@keweizhou1 shell]# history
   46  mv COPYING/ /usr/local/mysql/
   47  mv -r COPYING/ /usr/local/mysql/
   48  ls
   49  cp COPYING/ /usr/local/mysql/
   ....
```

4.也可以利用!+历史id号来实现快速执行命令：

```shell
[root@keweizhou1 shell]# !1037
pwd
/usr/local/shell
```

5.！！：执行上一次的命令，或者使用上下箭头翻阅

```shell
[root@keweizhou1 shell]# !!
pwd
/usr/local/shell
```

## bash特性汇总

- 文件路径利用tab键补全
- 命令补全
- 快捷键ctrl +a,e,u,k,l（比如ctrl+l快速清屏）
- 通配符
- 命令历史
- 命令别名
- 命令行展开

## shell变量

- 变量定义与赋值，注意变量与值之间不得有空格。
- 变量类型，bash默认把所有变量都认为是字符串
- bash变量是弱类型，无需事先申明类型，是将申明和赋值同时进行
- 变量替换和引用

```shell
[root@keweizhou1 shell]# name="keweizhou"
[root@keweizhou1 shell]# echo ${name}
keweizhou
# 也可以简写
[root@keweizhou1 shell]# echo $name
keweizhou
```

### 变量的命名规则

1. 名称定义要见名知意，切不得用保留关键字（help检查保留字）
2. 只能包含数字、字母、下划线
3. 不能以数字开头
4. 不能用标点符号
5. 变量名严格区分大小写（大写变量的定义和小写变量的定义是不一样的）

```shell
[root@keweizhou1 shell]# !!
echo $name
keweizhou
[root@keweizhou1 shell]# Name="okk"
[root@keweizhou1 shell]# echo $Name
okk
```

### 变量的作用域

pstree安装：

```shell
yum -y install psmisc
```

- 环境变量：也称之为全局变量，针对当前shell以及其任意子进程，环境变量也分为自定义、内置两种
- 局部变量：针对的是在shell函数或者是shell脚本中定义
- 位置脚本变量：用于shell函数中传递的参数
- 特殊变量：shell内置的特殊功效变量 $?(0表示成功，1-255错误码)，该命令表示上一条命令执行的是否成功
- 自定义变量： a.变量赋值：name=value b.变量引用：${name}、$name

shell变量默认都是定义为一个字符串类型的，一下三个定义是一个意思：

```shell
[root@keweizhou1 shell]# age=20
[root@keweizhou1 shell]# age='20'
[root@keweizhou1 shell]# age="20"
```

**注意1:**：

```text
单引号变量，不能识别特殊语法
双引号变量，能识别特殊语法
```

如：

```shell
[root@keweizhou1 shell]# echo '${name}'
${name}
[root@keweizhou1 shell]# echo "${name}"
keweizhou
```

**注意2:**：
1. 每次调用bash/sh解释器执行脚本，都会开启一个子shell，因此不保留当前的shell变量，通过pstre命令检查进程树
2. 调用source是在当前shell环境加载脚本，因此保留变量
